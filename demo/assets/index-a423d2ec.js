import{c as wt,b as ce,e as ir,r as qr,B as Ht,s as Cr,f as Fe,E as sr}from"./index-63e6b0de.js";import{f as De,s as Nr,a as Lr,d as Ur}from"./browser-ponyfill-7a33aa98.js";import{a as Pr,g as Br,d as jr,b as or,s as $r,r as ar,c as Je,e as Hr,m as Ze,f as Fr}from"./index-cd2418dd.js";var Nt={},Rt={};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.isBrowserCryptoAvailable=Rt.getSubtleCrypto=Rt.getBrowerCrypto=void 0;function ve(){return(wt===null||wt===void 0?void 0:wt.crypto)||(wt===null||wt===void 0?void 0:wt.msCrypto)||{}}Rt.getBrowerCrypto=ve;function hr(){const i=ve();return i.subtle||i.webkitSubtle}Rt.getSubtleCrypto=hr;function Dr(){return!!ve()&&!!hr()}Rt.isBrowserCryptoAvailable=Dr;var St={};Object.defineProperty(St,"__esModule",{value:!0});St.isBrowser=St.isNode=St.isReactNative=void 0;function fr(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}St.isReactNative=fr;function cr(){return typeof ce<"u"&&typeof ce.versions<"u"&&typeof ce.versions.node<"u"}St.isNode=cr;function Jr(){return!fr()&&!cr()}St.isBrowser=Jr;(function(i){var e=wt&&wt.__createBinding||(Object.create?function(l,m,u,x){x===void 0&&(x=u),Object.defineProperty(l,x,{enumerable:!0,get:function(){return m[u]}})}:function(l,m,u,x){x===void 0&&(x=u),l[x]=m[u]}),s=wt&&wt.__exportStar||function(l,m){for(var u in l)u!=="default"&&!m.hasOwnProperty(u)&&e(m,l,u)};Object.defineProperty(i,"__esModule",{value:!0}),s(Rt,i),s(St,i)})(Nt);function Zr(){const i=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return i+e}function Vr(i,e,s){return{id:s||Zr(),jsonrpc:"2.0",method:i,params:e}}let Wr=class{};class zr extends Wr{constructor(){super()}}class Qr extends zr{constructor(e){super()}}function Kr(i){return typeof i=="object"&&"id"in i&&"jsonrpc"in i&&i.jsonrpc==="2.0"}function Gr(i){return Kr(i)&&(Xr(i)||ur(i))}function Xr(i){return"result"in i}function ur(i){return"error"in i}class Ve extends Qr{constructor(e){super(e),this.events=new ir.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async request(e,s){return this.requestStrict(Vr(e.method,e.params||[]),s)}async requestStrict(e,s){return new Promise(async(l,m)=>{if(!this.connection.connected)try{await this.open()}catch(u){m(u)}this.events.on(`${e.id}`,u=>{ur(u)?m(u.error):l(u.result)});try{await this.connection.send(e,s)}catch(u){m(u)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Gr(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.hasRegisteredEventListeners=!0)}}function Yr(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return JSON.parse(i)}catch{return i}}function We(i){return typeof i=="string"?i:JSON.stringify(i)}const tn="PARSE_ERROR",en="INVALID_REQUEST",rn="METHOD_NOT_FOUND",nn="INVALID_PARAMS",lr="INTERNAL_ERROR",ye="SERVER_ERROR",sn=[-32700,-32600,-32601,-32602,-32603],Pt={[tn]:{code:-32700,message:"Parse error"},[en]:{code:-32600,message:"Invalid Request"},[rn]:{code:-32601,message:"Method not found"},[nn]:{code:-32602,message:"Invalid params"},[lr]:{code:-32603,message:"Internal error"},[ye]:{code:-32e3,message:"Server error"}},dr=ye;function on(i){return sn.includes(i)}function ze(i){return Object.keys(Pt).includes(i)?Pt[i]:Pt[dr]}function an(i){const e=Object.values(Pt).find(s=>s.code===i);return e||Pt[dr]}function hn(i,e,s){return i.message.includes("getaddrinfo ENOTFOUND")||i.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${s} RPC url at ${e}`):i}function fn(i,e,s){return{id:i,jsonrpc:"2.0",error:cn(e,s)}}function cn(i,e){return typeof i>"u"?ze(lr):(typeof i=="string"&&(i=Object.assign(Object.assign({},ze(ye)),{message:i})),typeof e<"u"&&(i.data=e),on(i.code)&&(i=an(i.code)),i)}const un="^https?:";function ln(i){const e=i.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function dn(i,e){const s=ln(i);return typeof s>"u"?!1:new RegExp(e).test(s)}function Qe(i){return dn(i,un)}const pn={Accept:"application/json","Content-Type":"application/json"},gn="POST",Ke={headers:pn,method:gn},Ge=10;class mn{constructor(e){if(this.url=e,this.events=new ir.EventEmitter,this.isAvailable=!1,this.registering=!1,!Qe(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e,s){this.isAvailable||await this.register();try{const l=We(e),u=await(await De(this.url,Object.assign(Object.assign({},Ke),{body:l}))).json();this.onPayload({data:u})}catch(l){this.onError(e.id,l)}}async register(e=this.url){if(!Qe(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const s=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=s||this.events.listenerCount("open")>=s)&&this.events.setMaxListeners(s+1),new Promise((l,m)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),m(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return m(new Error("HTTP connection is missing or invalid"));l()})})}this.url=e,this.registering=!0;try{const s=We({id:1,jsonrpc:"2.0",method:"test",params:[]});await De(e,Object.assign(Object.assign({},Ke),{body:s})),this.onOpen()}catch(s){const l=this.parseError(s);throw this.events.emit("register_error",l),this.onClose(),l}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const s=typeof e.data=="string"?Yr(e.data):e.data;this.events.emit("payload",s)}onError(e,s){const l=this.parseError(s),m=l.message||l.toString(),u=fn(e,m);this.events.emit("payload",u)}parseError(e,s=this.url){return hn(e,s,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ge&&this.events.setMaxListeners(Ge)}}const vn=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],we=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],yn={1:"mainnet",3:"ropsten",4:"rinkeby",5:"goerli",42:"kovan"};var pe={},wn={get exports(){return pe},set exports(i){pe=i}};(function(i){(function(e,s){function l(d,t){if(!d)throw new Error(t||"Assertion failed")}function m(d,t){d.super_=t;var n=function(){};n.prototype=t.prototype,d.prototype=new n,d.prototype.constructor=d}function u(d,t,n){if(u.isBN(d))return d;this.negative=0,this.words=null,this.length=0,this.red=null,d!==null&&((t==="le"||t==="be")&&(n=t,t=10),this._init(d||0,t||10,n||"be"))}typeof e=="object"?e.exports=u:s.BN=u,u.BN=u,u.wordSize=26;var x;try{x=qr().Buffer}catch{}u.isBN=function(t){return t instanceof u?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===u.wordSize&&Array.isArray(t.words)},u.max=function(t,n){return t.cmp(n)>0?t:n},u.min=function(t,n){return t.cmp(n)<0?t:n},u.prototype._init=function(t,n,o){if(typeof t=="number")return this._initNumber(t,n,o);if(typeof t=="object")return this._initArray(t,n,o);n==="hex"&&(n=16),l(n===(n|0)&&n>=2&&n<=36),t=t.toString().replace(/\s+/g,"");var a=0;t[0]==="-"&&a++,n===16?this._parseHex(t,a):this._parseBase(t,n,a),t[0]==="-"&&(this.negative=1),this.strip(),o==="le"&&this._initArray(this.toArray(),n,o)},u.prototype._initNumber=function(t,n,o){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(l(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),o==="le"&&this._initArray(this.toArray(),n,o)},u.prototype._initArray=function(t,n,o){if(l(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var a=0;a<this.length;a++)this.words[a]=0;var c,p,g=0;if(o==="be")for(a=t.length-1,c=0;a>=0;a-=3)p=t[a]|t[a-1]<<8|t[a-2]<<16,this.words[c]|=p<<g&67108863,this.words[c+1]=p>>>26-g&67108863,g+=24,g>=26&&(g-=26,c++);else if(o==="le")for(a=0,c=0;a<t.length;a+=3)p=t[a]|t[a+1]<<8|t[a+2]<<16,this.words[c]|=p<<g&67108863,this.words[c+1]=p>>>26-g&67108863,g+=24,g>=26&&(g-=26,c++);return this.strip()};function gt(d,t,n){for(var o=0,a=Math.min(d.length,n),c=t;c<a;c++){var p=d.charCodeAt(c)-48;o<<=4,p>=49&&p<=54?o|=p-49+10:p>=17&&p<=22?o|=p-17+10:o|=p&15}return o}u.prototype._parseHex=function(t,n){this.length=Math.ceil((t.length-n)/6),this.words=new Array(this.length);for(var o=0;o<this.length;o++)this.words[o]=0;var a,c,p=0;for(o=t.length-6,a=0;o>=n;o-=6)c=gt(t,o,o+6),this.words[a]|=c<<p&67108863,this.words[a+1]|=c>>>26-p&4194303,p+=24,p>=26&&(p-=26,a++);o+6!==n&&(c=gt(t,n,o+6),this.words[a]|=c<<p&67108863,this.words[a+1]|=c>>>26-p&4194303),this.strip()};function k(d,t,n,o){for(var a=0,c=Math.min(d.length,n),p=t;p<c;p++){var g=d.charCodeAt(p)-48;a*=o,g>=49?a+=g-49+10:g>=17?a+=g-17+10:a+=g}return a}u.prototype._parseBase=function(t,n,o){this.words=[0],this.length=1;for(var a=0,c=1;c<=67108863;c*=n)a++;a--,c=c/n|0;for(var p=t.length-o,g=p%a,h=Math.min(p,p-g)+o,r=0,f=o;f<h;f+=a)r=k(t,f,f+a,n),this.imuln(c),this.words[0]+r<67108864?this.words[0]+=r:this._iaddn(r);if(g!==0){var M=1;for(r=k(t,f,t.length,n),f=0;f<g;f++)M*=n;this.imuln(M),this.words[0]+r<67108864?this.words[0]+=r:this._iaddn(r)}},u.prototype.copy=function(t){t.words=new Array(this.length);for(var n=0;n<this.length;n++)t.words[n]=this.words[n];t.length=this.length,t.negative=this.negative,t.red=this.red},u.prototype.clone=function(){var t=new u(null);return this.copy(t),t},u.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},u.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},u.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},u.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var mt=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],xt=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],Mt=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];u.prototype.toString=function(t,n){t=t||10,n=n|0||1;var o;if(t===16||t==="hex"){o="";for(var a=0,c=0,p=0;p<this.length;p++){var g=this.words[p],h=((g<<a|c)&16777215).toString(16);c=g>>>24-a&16777215,c!==0||p!==this.length-1?o=mt[6-h.length]+h+o:o=h+o,a+=2,a>=26&&(a-=26,p--)}for(c!==0&&(o=c.toString(16)+o);o.length%n!==0;)o="0"+o;return this.negative!==0&&(o="-"+o),o}if(t===(t|0)&&t>=2&&t<=36){var r=xt[t],f=Mt[t];o="";var M=this.clone();for(M.negative=0;!M.isZero();){var b=M.modn(f).toString(t);M=M.idivn(f),M.isZero()?o=b+o:o=mt[r-b.length]+b+o}for(this.isZero()&&(o="0"+o);o.length%n!==0;)o="0"+o;return this.negative!==0&&(o="-"+o),o}l(!1,"Base should be between 2 and 36")},u.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&l(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},u.prototype.toJSON=function(){return this.toString(16)},u.prototype.toBuffer=function(t,n){return l(typeof x<"u"),this.toArrayLike(x,t,n)},u.prototype.toArray=function(t,n){return this.toArrayLike(Array,t,n)},u.prototype.toArrayLike=function(t,n,o){var a=this.byteLength(),c=o||Math.max(1,a);l(a<=c,"byte array longer than desired length"),l(c>0,"Requested array length <= 0"),this.strip();var p=n==="le",g=new t(c),h,r,f=this.clone();if(p){for(r=0;!f.isZero();r++)h=f.andln(255),f.iushrn(8),g[r]=h;for(;r<c;r++)g[r]=0}else{for(r=0;r<c-a;r++)g[r]=0;for(r=0;!f.isZero();r++)h=f.andln(255),f.iushrn(8),g[c-r-1]=h}return g},Math.clz32?u.prototype._countBits=function(t){return 32-Math.clz32(t)}:u.prototype._countBits=function(t){var n=t,o=0;return n>=4096&&(o+=13,n>>>=13),n>=64&&(o+=7,n>>>=7),n>=8&&(o+=4,n>>>=4),n>=2&&(o+=2,n>>>=2),o+n},u.prototype._zeroBits=function(t){if(t===0)return 26;var n=t,o=0;return n&8191||(o+=13,n>>>=13),n&127||(o+=7,n>>>=7),n&15||(o+=4,n>>>=4),n&3||(o+=2,n>>>=2),n&1||o++,o},u.prototype.bitLength=function(){var t=this.words[this.length-1],n=this._countBits(t);return(this.length-1)*26+n};function _t(d){for(var t=new Array(d.bitLength()),n=0;n<t.length;n++){var o=n/26|0,a=n%26;t[n]=(d.words[o]&1<<a)>>>a}return t}u.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,n=0;n<this.length;n++){var o=this._zeroBits(this.words[n]);if(t+=o,o!==26)break}return t},u.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},u.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},u.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},u.prototype.isNeg=function(){return this.negative!==0},u.prototype.neg=function(){return this.clone().ineg()},u.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},u.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var n=0;n<t.length;n++)this.words[n]=this.words[n]|t.words[n];return this.strip()},u.prototype.ior=function(t){return l((this.negative|t.negative)===0),this.iuor(t)},u.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},u.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},u.prototype.iuand=function(t){var n;this.length>t.length?n=t:n=this;for(var o=0;o<n.length;o++)this.words[o]=this.words[o]&t.words[o];return this.length=n.length,this.strip()},u.prototype.iand=function(t){return l((this.negative|t.negative)===0),this.iuand(t)},u.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},u.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},u.prototype.iuxor=function(t){var n,o;this.length>t.length?(n=this,o=t):(n=t,o=this);for(var a=0;a<o.length;a++)this.words[a]=n.words[a]^o.words[a];if(this!==n)for(;a<n.length;a++)this.words[a]=n.words[a];return this.length=n.length,this.strip()},u.prototype.ixor=function(t){return l((this.negative|t.negative)===0),this.iuxor(t)},u.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},u.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},u.prototype.inotn=function(t){l(typeof t=="number"&&t>=0);var n=Math.ceil(t/26)|0,o=t%26;this._expand(n),o>0&&n--;for(var a=0;a<n;a++)this.words[a]=~this.words[a]&67108863;return o>0&&(this.words[a]=~this.words[a]&67108863>>26-o),this.strip()},u.prototype.notn=function(t){return this.clone().inotn(t)},u.prototype.setn=function(t,n){l(typeof t=="number"&&t>=0);var o=t/26|0,a=t%26;return this._expand(o+1),n?this.words[o]=this.words[o]|1<<a:this.words[o]=this.words[o]&~(1<<a),this.strip()},u.prototype.iadd=function(t){var n;if(this.negative!==0&&t.negative===0)return this.negative=0,n=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,n=this.isub(t),t.negative=1,n._normSign();var o,a;this.length>t.length?(o=this,a=t):(o=t,a=this);for(var c=0,p=0;p<a.length;p++)n=(o.words[p]|0)+(a.words[p]|0)+c,this.words[p]=n&67108863,c=n>>>26;for(;c!==0&&p<o.length;p++)n=(o.words[p]|0)+c,this.words[p]=n&67108863,c=n>>>26;if(this.length=o.length,c!==0)this.words[this.length]=c,this.length++;else if(o!==this)for(;p<o.length;p++)this.words[p]=o.words[p];return this},u.prototype.add=function(t){var n;return t.negative!==0&&this.negative===0?(t.negative=0,n=this.sub(t),t.negative^=1,n):t.negative===0&&this.negative!==0?(this.negative=0,n=t.sub(this),this.negative=1,n):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},u.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var n=this.iadd(t);return t.negative=1,n._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var o=this.cmp(t);if(o===0)return this.negative=0,this.length=1,this.words[0]=0,this;var a,c;o>0?(a=this,c=t):(a=t,c=this);for(var p=0,g=0;g<c.length;g++)n=(a.words[g]|0)-(c.words[g]|0)+p,p=n>>26,this.words[g]=n&67108863;for(;p!==0&&g<a.length;g++)n=(a.words[g]|0)+p,p=n>>26,this.words[g]=n&67108863;if(p===0&&g<a.length&&a!==this)for(;g<a.length;g++)this.words[g]=a.words[g];return this.length=Math.max(this.length,g),a!==this&&(this.negative=1),this.strip()},u.prototype.sub=function(t){return this.clone().isub(t)};function yt(d,t,n){n.negative=t.negative^d.negative;var o=d.length+t.length|0;n.length=o,o=o-1|0;var a=d.words[0]|0,c=t.words[0]|0,p=a*c,g=p&67108863,h=p/67108864|0;n.words[0]=g;for(var r=1;r<o;r++){for(var f=h>>>26,M=h&67108863,b=Math.min(r,t.length-1),R=Math.max(0,r-d.length+1);R<=b;R++){var S=r-R|0;a=d.words[S]|0,c=t.words[R]|0,p=a*c+M,f+=p/67108864|0,M=p&67108863}n.words[r]=M|0,h=f|0}return h!==0?n.words[r]=h|0:n.length--,n.strip()}var Tt=function(t,n,o){var a=t.words,c=n.words,p=o.words,g=0,h,r,f,M=a[0]|0,b=M&8191,R=M>>>13,S=a[1]|0,O=S&8191,T=S>>>13,bt=a[2]|0,A=bt&8191,q=bt>>>13,Ee=a[3]|0,L=Ee&8191,U=Ee>>>13,Ie=a[4]|0,P=Ie&8191,B=Ie>>>13,xe=a[5]|0,j=xe&8191,$=xe>>>13,ke=a[6]|0,H=ke&8191,F=ke>>>13,Oe=a[7]|0,D=Oe&8191,J=Oe>>>13,Te=a[8]|0,Z=Te&8191,V=Te>>>13,Ae=a[9]|0,W=Ae&8191,z=Ae>>>13,qe=c[0]|0,Q=qe&8191,K=qe>>>13,Ce=c[1]|0,G=Ce&8191,X=Ce>>>13,Ne=c[2]|0,Y=Ne&8191,tt=Ne>>>13,Le=c[3]|0,et=Le&8191,rt=Le>>>13,Ue=c[4]|0,nt=Ue&8191,it=Ue>>>13,Pe=c[5]|0,st=Pe&8191,ot=Pe>>>13,Be=c[6]|0,at=Be&8191,ht=Be>>>13,je=c[7]|0,ft=je&8191,ct=je>>>13,$e=c[8]|0,ut=$e&8191,lt=$e>>>13,He=c[9]|0,dt=He&8191,pt=He>>>13;o.negative=t.negative^n.negative,o.length=19,h=Math.imul(b,Q),r=Math.imul(b,K),r=r+Math.imul(R,Q)|0,f=Math.imul(R,K);var Zt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Zt>>>26)|0,Zt&=67108863,h=Math.imul(O,Q),r=Math.imul(O,K),r=r+Math.imul(T,Q)|0,f=Math.imul(T,K),h=h+Math.imul(b,G)|0,r=r+Math.imul(b,X)|0,r=r+Math.imul(R,G)|0,f=f+Math.imul(R,X)|0;var Vt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,h=Math.imul(A,Q),r=Math.imul(A,K),r=r+Math.imul(q,Q)|0,f=Math.imul(q,K),h=h+Math.imul(O,G)|0,r=r+Math.imul(O,X)|0,r=r+Math.imul(T,G)|0,f=f+Math.imul(T,X)|0,h=h+Math.imul(b,Y)|0,r=r+Math.imul(b,tt)|0,r=r+Math.imul(R,Y)|0,f=f+Math.imul(R,tt)|0;var Wt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,h=Math.imul(L,Q),r=Math.imul(L,K),r=r+Math.imul(U,Q)|0,f=Math.imul(U,K),h=h+Math.imul(A,G)|0,r=r+Math.imul(A,X)|0,r=r+Math.imul(q,G)|0,f=f+Math.imul(q,X)|0,h=h+Math.imul(O,Y)|0,r=r+Math.imul(O,tt)|0,r=r+Math.imul(T,Y)|0,f=f+Math.imul(T,tt)|0,h=h+Math.imul(b,et)|0,r=r+Math.imul(b,rt)|0,r=r+Math.imul(R,et)|0,f=f+Math.imul(R,rt)|0;var zt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(zt>>>26)|0,zt&=67108863,h=Math.imul(P,Q),r=Math.imul(P,K),r=r+Math.imul(B,Q)|0,f=Math.imul(B,K),h=h+Math.imul(L,G)|0,r=r+Math.imul(L,X)|0,r=r+Math.imul(U,G)|0,f=f+Math.imul(U,X)|0,h=h+Math.imul(A,Y)|0,r=r+Math.imul(A,tt)|0,r=r+Math.imul(q,Y)|0,f=f+Math.imul(q,tt)|0,h=h+Math.imul(O,et)|0,r=r+Math.imul(O,rt)|0,r=r+Math.imul(T,et)|0,f=f+Math.imul(T,rt)|0,h=h+Math.imul(b,nt)|0,r=r+Math.imul(b,it)|0,r=r+Math.imul(R,nt)|0,f=f+Math.imul(R,it)|0;var Qt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Qt>>>26)|0,Qt&=67108863,h=Math.imul(j,Q),r=Math.imul(j,K),r=r+Math.imul($,Q)|0,f=Math.imul($,K),h=h+Math.imul(P,G)|0,r=r+Math.imul(P,X)|0,r=r+Math.imul(B,G)|0,f=f+Math.imul(B,X)|0,h=h+Math.imul(L,Y)|0,r=r+Math.imul(L,tt)|0,r=r+Math.imul(U,Y)|0,f=f+Math.imul(U,tt)|0,h=h+Math.imul(A,et)|0,r=r+Math.imul(A,rt)|0,r=r+Math.imul(q,et)|0,f=f+Math.imul(q,rt)|0,h=h+Math.imul(O,nt)|0,r=r+Math.imul(O,it)|0,r=r+Math.imul(T,nt)|0,f=f+Math.imul(T,it)|0,h=h+Math.imul(b,st)|0,r=r+Math.imul(b,ot)|0,r=r+Math.imul(R,st)|0,f=f+Math.imul(R,ot)|0;var Kt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Kt>>>26)|0,Kt&=67108863,h=Math.imul(H,Q),r=Math.imul(H,K),r=r+Math.imul(F,Q)|0,f=Math.imul(F,K),h=h+Math.imul(j,G)|0,r=r+Math.imul(j,X)|0,r=r+Math.imul($,G)|0,f=f+Math.imul($,X)|0,h=h+Math.imul(P,Y)|0,r=r+Math.imul(P,tt)|0,r=r+Math.imul(B,Y)|0,f=f+Math.imul(B,tt)|0,h=h+Math.imul(L,et)|0,r=r+Math.imul(L,rt)|0,r=r+Math.imul(U,et)|0,f=f+Math.imul(U,rt)|0,h=h+Math.imul(A,nt)|0,r=r+Math.imul(A,it)|0,r=r+Math.imul(q,nt)|0,f=f+Math.imul(q,it)|0,h=h+Math.imul(O,st)|0,r=r+Math.imul(O,ot)|0,r=r+Math.imul(T,st)|0,f=f+Math.imul(T,ot)|0,h=h+Math.imul(b,at)|0,r=r+Math.imul(b,ht)|0,r=r+Math.imul(R,at)|0,f=f+Math.imul(R,ht)|0;var Gt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,h=Math.imul(D,Q),r=Math.imul(D,K),r=r+Math.imul(J,Q)|0,f=Math.imul(J,K),h=h+Math.imul(H,G)|0,r=r+Math.imul(H,X)|0,r=r+Math.imul(F,G)|0,f=f+Math.imul(F,X)|0,h=h+Math.imul(j,Y)|0,r=r+Math.imul(j,tt)|0,r=r+Math.imul($,Y)|0,f=f+Math.imul($,tt)|0,h=h+Math.imul(P,et)|0,r=r+Math.imul(P,rt)|0,r=r+Math.imul(B,et)|0,f=f+Math.imul(B,rt)|0,h=h+Math.imul(L,nt)|0,r=r+Math.imul(L,it)|0,r=r+Math.imul(U,nt)|0,f=f+Math.imul(U,it)|0,h=h+Math.imul(A,st)|0,r=r+Math.imul(A,ot)|0,r=r+Math.imul(q,st)|0,f=f+Math.imul(q,ot)|0,h=h+Math.imul(O,at)|0,r=r+Math.imul(O,ht)|0,r=r+Math.imul(T,at)|0,f=f+Math.imul(T,ht)|0,h=h+Math.imul(b,ft)|0,r=r+Math.imul(b,ct)|0,r=r+Math.imul(R,ft)|0,f=f+Math.imul(R,ct)|0;var Xt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Xt>>>26)|0,Xt&=67108863,h=Math.imul(Z,Q),r=Math.imul(Z,K),r=r+Math.imul(V,Q)|0,f=Math.imul(V,K),h=h+Math.imul(D,G)|0,r=r+Math.imul(D,X)|0,r=r+Math.imul(J,G)|0,f=f+Math.imul(J,X)|0,h=h+Math.imul(H,Y)|0,r=r+Math.imul(H,tt)|0,r=r+Math.imul(F,Y)|0,f=f+Math.imul(F,tt)|0,h=h+Math.imul(j,et)|0,r=r+Math.imul(j,rt)|0,r=r+Math.imul($,et)|0,f=f+Math.imul($,rt)|0,h=h+Math.imul(P,nt)|0,r=r+Math.imul(P,it)|0,r=r+Math.imul(B,nt)|0,f=f+Math.imul(B,it)|0,h=h+Math.imul(L,st)|0,r=r+Math.imul(L,ot)|0,r=r+Math.imul(U,st)|0,f=f+Math.imul(U,ot)|0,h=h+Math.imul(A,at)|0,r=r+Math.imul(A,ht)|0,r=r+Math.imul(q,at)|0,f=f+Math.imul(q,ht)|0,h=h+Math.imul(O,ft)|0,r=r+Math.imul(O,ct)|0,r=r+Math.imul(T,ft)|0,f=f+Math.imul(T,ct)|0,h=h+Math.imul(b,ut)|0,r=r+Math.imul(b,lt)|0,r=r+Math.imul(R,ut)|0,f=f+Math.imul(R,lt)|0;var Yt=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,h=Math.imul(W,Q),r=Math.imul(W,K),r=r+Math.imul(z,Q)|0,f=Math.imul(z,K),h=h+Math.imul(Z,G)|0,r=r+Math.imul(Z,X)|0,r=r+Math.imul(V,G)|0,f=f+Math.imul(V,X)|0,h=h+Math.imul(D,Y)|0,r=r+Math.imul(D,tt)|0,r=r+Math.imul(J,Y)|0,f=f+Math.imul(J,tt)|0,h=h+Math.imul(H,et)|0,r=r+Math.imul(H,rt)|0,r=r+Math.imul(F,et)|0,f=f+Math.imul(F,rt)|0,h=h+Math.imul(j,nt)|0,r=r+Math.imul(j,it)|0,r=r+Math.imul($,nt)|0,f=f+Math.imul($,it)|0,h=h+Math.imul(P,st)|0,r=r+Math.imul(P,ot)|0,r=r+Math.imul(B,st)|0,f=f+Math.imul(B,ot)|0,h=h+Math.imul(L,at)|0,r=r+Math.imul(L,ht)|0,r=r+Math.imul(U,at)|0,f=f+Math.imul(U,ht)|0,h=h+Math.imul(A,ft)|0,r=r+Math.imul(A,ct)|0,r=r+Math.imul(q,ft)|0,f=f+Math.imul(q,ct)|0,h=h+Math.imul(O,ut)|0,r=r+Math.imul(O,lt)|0,r=r+Math.imul(T,ut)|0,f=f+Math.imul(T,lt)|0,h=h+Math.imul(b,dt)|0,r=r+Math.imul(b,pt)|0,r=r+Math.imul(R,dt)|0,f=f+Math.imul(R,pt)|0;var te=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(te>>>26)|0,te&=67108863,h=Math.imul(W,G),r=Math.imul(W,X),r=r+Math.imul(z,G)|0,f=Math.imul(z,X),h=h+Math.imul(Z,Y)|0,r=r+Math.imul(Z,tt)|0,r=r+Math.imul(V,Y)|0,f=f+Math.imul(V,tt)|0,h=h+Math.imul(D,et)|0,r=r+Math.imul(D,rt)|0,r=r+Math.imul(J,et)|0,f=f+Math.imul(J,rt)|0,h=h+Math.imul(H,nt)|0,r=r+Math.imul(H,it)|0,r=r+Math.imul(F,nt)|0,f=f+Math.imul(F,it)|0,h=h+Math.imul(j,st)|0,r=r+Math.imul(j,ot)|0,r=r+Math.imul($,st)|0,f=f+Math.imul($,ot)|0,h=h+Math.imul(P,at)|0,r=r+Math.imul(P,ht)|0,r=r+Math.imul(B,at)|0,f=f+Math.imul(B,ht)|0,h=h+Math.imul(L,ft)|0,r=r+Math.imul(L,ct)|0,r=r+Math.imul(U,ft)|0,f=f+Math.imul(U,ct)|0,h=h+Math.imul(A,ut)|0,r=r+Math.imul(A,lt)|0,r=r+Math.imul(q,ut)|0,f=f+Math.imul(q,lt)|0,h=h+Math.imul(O,dt)|0,r=r+Math.imul(O,pt)|0,r=r+Math.imul(T,dt)|0,f=f+Math.imul(T,pt)|0;var ee=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(ee>>>26)|0,ee&=67108863,h=Math.imul(W,Y),r=Math.imul(W,tt),r=r+Math.imul(z,Y)|0,f=Math.imul(z,tt),h=h+Math.imul(Z,et)|0,r=r+Math.imul(Z,rt)|0,r=r+Math.imul(V,et)|0,f=f+Math.imul(V,rt)|0,h=h+Math.imul(D,nt)|0,r=r+Math.imul(D,it)|0,r=r+Math.imul(J,nt)|0,f=f+Math.imul(J,it)|0,h=h+Math.imul(H,st)|0,r=r+Math.imul(H,ot)|0,r=r+Math.imul(F,st)|0,f=f+Math.imul(F,ot)|0,h=h+Math.imul(j,at)|0,r=r+Math.imul(j,ht)|0,r=r+Math.imul($,at)|0,f=f+Math.imul($,ht)|0,h=h+Math.imul(P,ft)|0,r=r+Math.imul(P,ct)|0,r=r+Math.imul(B,ft)|0,f=f+Math.imul(B,ct)|0,h=h+Math.imul(L,ut)|0,r=r+Math.imul(L,lt)|0,r=r+Math.imul(U,ut)|0,f=f+Math.imul(U,lt)|0,h=h+Math.imul(A,dt)|0,r=r+Math.imul(A,pt)|0,r=r+Math.imul(q,dt)|0,f=f+Math.imul(q,pt)|0;var re=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(re>>>26)|0,re&=67108863,h=Math.imul(W,et),r=Math.imul(W,rt),r=r+Math.imul(z,et)|0,f=Math.imul(z,rt),h=h+Math.imul(Z,nt)|0,r=r+Math.imul(Z,it)|0,r=r+Math.imul(V,nt)|0,f=f+Math.imul(V,it)|0,h=h+Math.imul(D,st)|0,r=r+Math.imul(D,ot)|0,r=r+Math.imul(J,st)|0,f=f+Math.imul(J,ot)|0,h=h+Math.imul(H,at)|0,r=r+Math.imul(H,ht)|0,r=r+Math.imul(F,at)|0,f=f+Math.imul(F,ht)|0,h=h+Math.imul(j,ft)|0,r=r+Math.imul(j,ct)|0,r=r+Math.imul($,ft)|0,f=f+Math.imul($,ct)|0,h=h+Math.imul(P,ut)|0,r=r+Math.imul(P,lt)|0,r=r+Math.imul(B,ut)|0,f=f+Math.imul(B,lt)|0,h=h+Math.imul(L,dt)|0,r=r+Math.imul(L,pt)|0,r=r+Math.imul(U,dt)|0,f=f+Math.imul(U,pt)|0;var ne=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(ne>>>26)|0,ne&=67108863,h=Math.imul(W,nt),r=Math.imul(W,it),r=r+Math.imul(z,nt)|0,f=Math.imul(z,it),h=h+Math.imul(Z,st)|0,r=r+Math.imul(Z,ot)|0,r=r+Math.imul(V,st)|0,f=f+Math.imul(V,ot)|0,h=h+Math.imul(D,at)|0,r=r+Math.imul(D,ht)|0,r=r+Math.imul(J,at)|0,f=f+Math.imul(J,ht)|0,h=h+Math.imul(H,ft)|0,r=r+Math.imul(H,ct)|0,r=r+Math.imul(F,ft)|0,f=f+Math.imul(F,ct)|0,h=h+Math.imul(j,ut)|0,r=r+Math.imul(j,lt)|0,r=r+Math.imul($,ut)|0,f=f+Math.imul($,lt)|0,h=h+Math.imul(P,dt)|0,r=r+Math.imul(P,pt)|0,r=r+Math.imul(B,dt)|0,f=f+Math.imul(B,pt)|0;var ie=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(ie>>>26)|0,ie&=67108863,h=Math.imul(W,st),r=Math.imul(W,ot),r=r+Math.imul(z,st)|0,f=Math.imul(z,ot),h=h+Math.imul(Z,at)|0,r=r+Math.imul(Z,ht)|0,r=r+Math.imul(V,at)|0,f=f+Math.imul(V,ht)|0,h=h+Math.imul(D,ft)|0,r=r+Math.imul(D,ct)|0,r=r+Math.imul(J,ft)|0,f=f+Math.imul(J,ct)|0,h=h+Math.imul(H,ut)|0,r=r+Math.imul(H,lt)|0,r=r+Math.imul(F,ut)|0,f=f+Math.imul(F,lt)|0,h=h+Math.imul(j,dt)|0,r=r+Math.imul(j,pt)|0,r=r+Math.imul($,dt)|0,f=f+Math.imul($,pt)|0;var se=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(se>>>26)|0,se&=67108863,h=Math.imul(W,at),r=Math.imul(W,ht),r=r+Math.imul(z,at)|0,f=Math.imul(z,ht),h=h+Math.imul(Z,ft)|0,r=r+Math.imul(Z,ct)|0,r=r+Math.imul(V,ft)|0,f=f+Math.imul(V,ct)|0,h=h+Math.imul(D,ut)|0,r=r+Math.imul(D,lt)|0,r=r+Math.imul(J,ut)|0,f=f+Math.imul(J,lt)|0,h=h+Math.imul(H,dt)|0,r=r+Math.imul(H,pt)|0,r=r+Math.imul(F,dt)|0,f=f+Math.imul(F,pt)|0;var oe=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(oe>>>26)|0,oe&=67108863,h=Math.imul(W,ft),r=Math.imul(W,ct),r=r+Math.imul(z,ft)|0,f=Math.imul(z,ct),h=h+Math.imul(Z,ut)|0,r=r+Math.imul(Z,lt)|0,r=r+Math.imul(V,ut)|0,f=f+Math.imul(V,lt)|0,h=h+Math.imul(D,dt)|0,r=r+Math.imul(D,pt)|0,r=r+Math.imul(J,dt)|0,f=f+Math.imul(J,pt)|0;var ae=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(ae>>>26)|0,ae&=67108863,h=Math.imul(W,ut),r=Math.imul(W,lt),r=r+Math.imul(z,ut)|0,f=Math.imul(z,lt),h=h+Math.imul(Z,dt)|0,r=r+Math.imul(Z,pt)|0,r=r+Math.imul(V,dt)|0,f=f+Math.imul(V,pt)|0;var he=(g+h|0)+((r&8191)<<13)|0;g=(f+(r>>>13)|0)+(he>>>26)|0,he&=67108863,h=Math.imul(W,dt),r=Math.imul(W,pt),r=r+Math.imul(z,dt)|0,f=Math.imul(z,pt);var fe=(g+h|0)+((r&8191)<<13)|0;return g=(f+(r>>>13)|0)+(fe>>>26)|0,fe&=67108863,p[0]=Zt,p[1]=Vt,p[2]=Wt,p[3]=zt,p[4]=Qt,p[5]=Kt,p[6]=Gt,p[7]=Xt,p[8]=Yt,p[9]=te,p[10]=ee,p[11]=re,p[12]=ne,p[13]=ie,p[14]=se,p[15]=oe,p[16]=ae,p[17]=he,p[18]=fe,g!==0&&(p[19]=g,o.length++),o};Math.imul||(Tt=yt);function jt(d,t,n){n.negative=t.negative^d.negative,n.length=d.length+t.length;for(var o=0,a=0,c=0;c<n.length-1;c++){var p=a;a=0;for(var g=o&67108863,h=Math.min(c,t.length-1),r=Math.max(0,c-d.length+1);r<=h;r++){var f=c-r,M=d.words[f]|0,b=t.words[r]|0,R=M*b,S=R&67108863;p=p+(R/67108864|0)|0,S=S+g|0,g=S&67108863,p=p+(S>>>26)|0,a+=p>>>26,p&=67108863}n.words[c]=g,o=p,p=a}return o!==0?n.words[c]=o:n.length--,n.strip()}function v(d,t,n){var o=new y;return o.mulp(d,t,n)}u.prototype.mulTo=function(t,n){var o,a=this.length+t.length;return this.length===10&&t.length===10?o=Tt(this,t,n):a<63?o=yt(this,t,n):a<1024?o=jt(this,t,n):o=v(this,t,n),o};function y(d,t){this.x=d,this.y=t}y.prototype.makeRBT=function(t){for(var n=new Array(t),o=u.prototype._countBits(t)-1,a=0;a<t;a++)n[a]=this.revBin(a,o,t);return n},y.prototype.revBin=function(t,n,o){if(t===0||t===o-1)return t;for(var a=0,c=0;c<n;c++)a|=(t&1)<<n-c-1,t>>=1;return a},y.prototype.permute=function(t,n,o,a,c,p){for(var g=0;g<p;g++)a[g]=n[t[g]],c[g]=o[t[g]]},y.prototype.transform=function(t,n,o,a,c,p){this.permute(p,t,n,o,a,c);for(var g=1;g<c;g<<=1)for(var h=g<<1,r=Math.cos(2*Math.PI/h),f=Math.sin(2*Math.PI/h),M=0;M<c;M+=h)for(var b=r,R=f,S=0;S<g;S++){var O=o[M+S],T=a[M+S],bt=o[M+S+g],A=a[M+S+g],q=b*bt-R*A;A=b*A+R*bt,bt=q,o[M+S]=O+bt,a[M+S]=T+A,o[M+S+g]=O-bt,a[M+S+g]=T-A,S!==h&&(q=r*b-f*R,R=r*R+f*b,b=q)}},y.prototype.guessLen13b=function(t,n){var o=Math.max(n,t)|1,a=o&1,c=0;for(o=o/2|0;o;o=o>>>1)c++;return 1<<c+1+a},y.prototype.conjugate=function(t,n,o){if(!(o<=1))for(var a=0;a<o/2;a++){var c=t[a];t[a]=t[o-a-1],t[o-a-1]=c,c=n[a],n[a]=-n[o-a-1],n[o-a-1]=-c}},y.prototype.normalize13b=function(t,n){for(var o=0,a=0;a<n/2;a++){var c=Math.round(t[2*a+1]/n)*8192+Math.round(t[2*a]/n)+o;t[a]=c&67108863,c<67108864?o=0:o=c/67108864|0}return t},y.prototype.convert13b=function(t,n,o,a){for(var c=0,p=0;p<n;p++)c=c+(t[p]|0),o[2*p]=c&8191,c=c>>>13,o[2*p+1]=c&8191,c=c>>>13;for(p=2*n;p<a;++p)o[p]=0;l(c===0),l((c&-8192)===0)},y.prototype.stub=function(t){for(var n=new Array(t),o=0;o<t;o++)n[o]=0;return n},y.prototype.mulp=function(t,n,o){var a=2*this.guessLen13b(t.length,n.length),c=this.makeRBT(a),p=this.stub(a),g=new Array(a),h=new Array(a),r=new Array(a),f=new Array(a),M=new Array(a),b=new Array(a),R=o.words;R.length=a,this.convert13b(t.words,t.length,g,a),this.convert13b(n.words,n.length,f,a),this.transform(g,p,h,r,a,c),this.transform(f,p,M,b,a,c);for(var S=0;S<a;S++){var O=h[S]*M[S]-r[S]*b[S];r[S]=h[S]*b[S]+r[S]*M[S],h[S]=O}return this.conjugate(h,r,a),this.transform(h,r,R,p,a,c),this.conjugate(R,p,a),this.normalize13b(R,a),o.negative=t.negative^n.negative,o.length=t.length+n.length,o.strip()},u.prototype.mul=function(t){var n=new u(null);return n.words=new Array(this.length+t.length),this.mulTo(t,n)},u.prototype.mulf=function(t){var n=new u(null);return n.words=new Array(this.length+t.length),v(this,t,n)},u.prototype.imul=function(t){return this.clone().mulTo(t,this)},u.prototype.imuln=function(t){l(typeof t=="number"),l(t<67108864);for(var n=0,o=0;o<this.length;o++){var a=(this.words[o]|0)*t,c=(a&67108863)+(n&67108863);n>>=26,n+=a/67108864|0,n+=c>>>26,this.words[o]=c&67108863}return n!==0&&(this.words[o]=n,this.length++),this},u.prototype.muln=function(t){return this.clone().imuln(t)},u.prototype.sqr=function(){return this.mul(this)},u.prototype.isqr=function(){return this.imul(this.clone())},u.prototype.pow=function(t){var n=_t(t);if(n.length===0)return new u(1);for(var o=this,a=0;a<n.length&&n[a]===0;a++,o=o.sqr());if(++a<n.length)for(var c=o.sqr();a<n.length;a++,c=c.sqr())n[a]!==0&&(o=o.mul(c));return o},u.prototype.iushln=function(t){l(typeof t=="number"&&t>=0);var n=t%26,o=(t-n)/26,a=67108863>>>26-n<<26-n,c;if(n!==0){var p=0;for(c=0;c<this.length;c++){var g=this.words[c]&a,h=(this.words[c]|0)-g<<n;this.words[c]=h|p,p=g>>>26-n}p&&(this.words[c]=p,this.length++)}if(o!==0){for(c=this.length-1;c>=0;c--)this.words[c+o]=this.words[c];for(c=0;c<o;c++)this.words[c]=0;this.length+=o}return this.strip()},u.prototype.ishln=function(t){return l(this.negative===0),this.iushln(t)},u.prototype.iushrn=function(t,n,o){l(typeof t=="number"&&t>=0);var a;n?a=(n-n%26)/26:a=0;var c=t%26,p=Math.min((t-c)/26,this.length),g=67108863^67108863>>>c<<c,h=o;if(a-=p,a=Math.max(0,a),h){for(var r=0;r<p;r++)h.words[r]=this.words[r];h.length=p}if(p!==0)if(this.length>p)for(this.length-=p,r=0;r<this.length;r++)this.words[r]=this.words[r+p];else this.words[0]=0,this.length=1;var f=0;for(r=this.length-1;r>=0&&(f!==0||r>=a);r--){var M=this.words[r]|0;this.words[r]=f<<26-c|M>>>c,f=M&g}return h&&f!==0&&(h.words[h.length++]=f),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},u.prototype.ishrn=function(t,n,o){return l(this.negative===0),this.iushrn(t,n,o)},u.prototype.shln=function(t){return this.clone().ishln(t)},u.prototype.ushln=function(t){return this.clone().iushln(t)},u.prototype.shrn=function(t){return this.clone().ishrn(t)},u.prototype.ushrn=function(t){return this.clone().iushrn(t)},u.prototype.testn=function(t){l(typeof t=="number"&&t>=0);var n=t%26,o=(t-n)/26,a=1<<n;if(this.length<=o)return!1;var c=this.words[o];return!!(c&a)},u.prototype.imaskn=function(t){l(typeof t=="number"&&t>=0);var n=t%26,o=(t-n)/26;if(l(this.negative===0,"imaskn works only with positive numbers"),this.length<=o)return this;if(n!==0&&o++,this.length=Math.min(o,this.length),n!==0){var a=67108863^67108863>>>n<<n;this.words[this.length-1]&=a}return this.strip()},u.prototype.maskn=function(t){return this.clone().imaskn(t)},u.prototype.iaddn=function(t){return l(typeof t=="number"),l(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},u.prototype._iaddn=function(t){this.words[0]+=t;for(var n=0;n<this.length&&this.words[n]>=67108864;n++)this.words[n]-=67108864,n===this.length-1?this.words[n+1]=1:this.words[n+1]++;return this.length=Math.max(this.length,n+1),this},u.prototype.isubn=function(t){if(l(typeof t=="number"),l(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var n=0;n<this.length&&this.words[n]<0;n++)this.words[n]+=67108864,this.words[n+1]-=1;return this.strip()},u.prototype.addn=function(t){return this.clone().iaddn(t)},u.prototype.subn=function(t){return this.clone().isubn(t)},u.prototype.iabs=function(){return this.negative=0,this},u.prototype.abs=function(){return this.clone().iabs()},u.prototype._ishlnsubmul=function(t,n,o){var a=t.length+o,c;this._expand(a);var p,g=0;for(c=0;c<t.length;c++){p=(this.words[c+o]|0)+g;var h=(t.words[c]|0)*n;p-=h&67108863,g=(p>>26)-(h/67108864|0),this.words[c+o]=p&67108863}for(;c<this.length-o;c++)p=(this.words[c+o]|0)+g,g=p>>26,this.words[c+o]=p&67108863;if(g===0)return this.strip();for(l(g===-1),g=0,c=0;c<this.length;c++)p=-(this.words[c]|0)+g,g=p>>26,this.words[c]=p&67108863;return this.negative=1,this.strip()},u.prototype._wordDiv=function(t,n){var o=this.length-t.length,a=this.clone(),c=t,p=c.words[c.length-1]|0,g=this._countBits(p);o=26-g,o!==0&&(c=c.ushln(o),a.iushln(o),p=c.words[c.length-1]|0);var h=a.length-c.length,r;if(n!=="mod"){r=new u(null),r.length=h+1,r.words=new Array(r.length);for(var f=0;f<r.length;f++)r.words[f]=0}var M=a.clone()._ishlnsubmul(c,1,h);M.negative===0&&(a=M,r&&(r.words[h]=1));for(var b=h-1;b>=0;b--){var R=(a.words[c.length+b]|0)*67108864+(a.words[c.length+b-1]|0);for(R=Math.min(R/p|0,67108863),a._ishlnsubmul(c,R,b);a.negative!==0;)R--,a.negative=0,a._ishlnsubmul(c,1,b),a.isZero()||(a.negative^=1);r&&(r.words[b]=R)}return r&&r.strip(),a.strip(),n!=="div"&&o!==0&&a.iushrn(o),{div:r||null,mod:a}},u.prototype.divmod=function(t,n,o){if(l(!t.isZero()),this.isZero())return{div:new u(0),mod:new u(0)};var a,c,p;return this.negative!==0&&t.negative===0?(p=this.neg().divmod(t,n),n!=="mod"&&(a=p.div.neg()),n!=="div"&&(c=p.mod.neg(),o&&c.negative!==0&&c.iadd(t)),{div:a,mod:c}):this.negative===0&&t.negative!==0?(p=this.divmod(t.neg(),n),n!=="mod"&&(a=p.div.neg()),{div:a,mod:p.mod}):this.negative&t.negative?(p=this.neg().divmod(t.neg(),n),n!=="div"&&(c=p.mod.neg(),o&&c.negative!==0&&c.isub(t)),{div:p.div,mod:c}):t.length>this.length||this.cmp(t)<0?{div:new u(0),mod:this}:t.length===1?n==="div"?{div:this.divn(t.words[0]),mod:null}:n==="mod"?{div:null,mod:new u(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new u(this.modn(t.words[0]))}:this._wordDiv(t,n)},u.prototype.div=function(t){return this.divmod(t,"div",!1).div},u.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},u.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},u.prototype.divRound=function(t){var n=this.divmod(t);if(n.mod.isZero())return n.div;var o=n.div.negative!==0?n.mod.isub(t):n.mod,a=t.ushrn(1),c=t.andln(1),p=o.cmp(a);return p<0||c===1&&p===0?n.div:n.div.negative!==0?n.div.isubn(1):n.div.iaddn(1)},u.prototype.modn=function(t){l(t<=67108863);for(var n=(1<<26)%t,o=0,a=this.length-1;a>=0;a--)o=(n*o+(this.words[a]|0))%t;return o},u.prototype.idivn=function(t){l(t<=67108863);for(var n=0,o=this.length-1;o>=0;o--){var a=(this.words[o]|0)+n*67108864;this.words[o]=a/t|0,n=a%t}return this.strip()},u.prototype.divn=function(t){return this.clone().idivn(t)},u.prototype.egcd=function(t){l(t.negative===0),l(!t.isZero());var n=this,o=t.clone();n.negative!==0?n=n.umod(t):n=n.clone();for(var a=new u(1),c=new u(0),p=new u(0),g=new u(1),h=0;n.isEven()&&o.isEven();)n.iushrn(1),o.iushrn(1),++h;for(var r=o.clone(),f=n.clone();!n.isZero();){for(var M=0,b=1;!(n.words[0]&b)&&M<26;++M,b<<=1);if(M>0)for(n.iushrn(M);M-- >0;)(a.isOdd()||c.isOdd())&&(a.iadd(r),c.isub(f)),a.iushrn(1),c.iushrn(1);for(var R=0,S=1;!(o.words[0]&S)&&R<26;++R,S<<=1);if(R>0)for(o.iushrn(R);R-- >0;)(p.isOdd()||g.isOdd())&&(p.iadd(r),g.isub(f)),p.iushrn(1),g.iushrn(1);n.cmp(o)>=0?(n.isub(o),a.isub(p),c.isub(g)):(o.isub(n),p.isub(a),g.isub(c))}return{a:p,b:g,gcd:o.iushln(h)}},u.prototype._invmp=function(t){l(t.negative===0),l(!t.isZero());var n=this,o=t.clone();n.negative!==0?n=n.umod(t):n=n.clone();for(var a=new u(1),c=new u(0),p=o.clone();n.cmpn(1)>0&&o.cmpn(1)>0;){for(var g=0,h=1;!(n.words[0]&h)&&g<26;++g,h<<=1);if(g>0)for(n.iushrn(g);g-- >0;)a.isOdd()&&a.iadd(p),a.iushrn(1);for(var r=0,f=1;!(o.words[0]&f)&&r<26;++r,f<<=1);if(r>0)for(o.iushrn(r);r-- >0;)c.isOdd()&&c.iadd(p),c.iushrn(1);n.cmp(o)>=0?(n.isub(o),a.isub(c)):(o.isub(n),c.isub(a))}var M;return n.cmpn(1)===0?M=a:M=c,M.cmpn(0)<0&&M.iadd(t),M},u.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var n=this.clone(),o=t.clone();n.negative=0,o.negative=0;for(var a=0;n.isEven()&&o.isEven();a++)n.iushrn(1),o.iushrn(1);do{for(;n.isEven();)n.iushrn(1);for(;o.isEven();)o.iushrn(1);var c=n.cmp(o);if(c<0){var p=n;n=o,o=p}else if(c===0||o.cmpn(1)===0)break;n.isub(o)}while(!0);return o.iushln(a)},u.prototype.invm=function(t){return this.egcd(t).a.umod(t)},u.prototype.isEven=function(){return(this.words[0]&1)===0},u.prototype.isOdd=function(){return(this.words[0]&1)===1},u.prototype.andln=function(t){return this.words[0]&t},u.prototype.bincn=function(t){l(typeof t=="number");var n=t%26,o=(t-n)/26,a=1<<n;if(this.length<=o)return this._expand(o+1),this.words[o]|=a,this;for(var c=a,p=o;c!==0&&p<this.length;p++){var g=this.words[p]|0;g+=c,c=g>>>26,g&=67108863,this.words[p]=g}return c!==0&&(this.words[p]=c,this.length++),this},u.prototype.isZero=function(){return this.length===1&&this.words[0]===0},u.prototype.cmpn=function(t){var n=t<0;if(this.negative!==0&&!n)return-1;if(this.negative===0&&n)return 1;this.strip();var o;if(this.length>1)o=1;else{n&&(t=-t),l(t<=67108863,"Number is too big");var a=this.words[0]|0;o=a===t?0:a<t?-1:1}return this.negative!==0?-o|0:o},u.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var n=this.ucmp(t);return this.negative!==0?-n|0:n},u.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var n=0,o=this.length-1;o>=0;o--){var a=this.words[o]|0,c=t.words[o]|0;if(a!==c){a<c?n=-1:a>c&&(n=1);break}}return n},u.prototype.gtn=function(t){return this.cmpn(t)===1},u.prototype.gt=function(t){return this.cmp(t)===1},u.prototype.gten=function(t){return this.cmpn(t)>=0},u.prototype.gte=function(t){return this.cmp(t)>=0},u.prototype.ltn=function(t){return this.cmpn(t)===-1},u.prototype.lt=function(t){return this.cmp(t)===-1},u.prototype.lten=function(t){return this.cmpn(t)<=0},u.prototype.lte=function(t){return this.cmp(t)<=0},u.prototype.eqn=function(t){return this.cmpn(t)===0},u.prototype.eq=function(t){return this.cmp(t)===0},u.red=function(t){return new N(t)},u.prototype.toRed=function(t){return l(!this.red,"Already a number in reduction context"),l(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},u.prototype.fromRed=function(){return l(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},u.prototype._forceRed=function(t){return this.red=t,this},u.prototype.forceRed=function(t){return l(!this.red,"Already a number in reduction context"),this._forceRed(t)},u.prototype.redAdd=function(t){return l(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},u.prototype.redIAdd=function(t){return l(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},u.prototype.redSub=function(t){return l(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},u.prototype.redISub=function(t){return l(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},u.prototype.redShl=function(t){return l(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},u.prototype.redMul=function(t){return l(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},u.prototype.redIMul=function(t){return l(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},u.prototype.redSqr=function(){return l(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},u.prototype.redISqr=function(){return l(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},u.prototype.redSqrt=function(){return l(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},u.prototype.redInvm=function(){return l(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},u.prototype.redNeg=function(){return l(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},u.prototype.redPow=function(t){return l(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var _={k256:null,p224:null,p192:null,p25519:null};function w(d,t){this.name=d,this.p=new u(t,16),this.n=this.p.bitLength(),this.k=new u(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}w.prototype._tmp=function(){var t=new u(null);return t.words=new Array(Math.ceil(this.n/13)),t},w.prototype.ireduce=function(t){var n=t,o;do this.split(n,this.tmp),n=this.imulK(n),n=n.iadd(this.tmp),o=n.bitLength();while(o>this.n);var a=o<this.n?-1:n.ucmp(this.p);return a===0?(n.words[0]=0,n.length=1):a>0?n.isub(this.p):n.strip(),n},w.prototype.split=function(t,n){t.iushrn(this.n,0,n)},w.prototype.imulK=function(t){return t.imul(this.k)};function E(){w.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}m(E,w),E.prototype.split=function(t,n){for(var o=4194303,a=Math.min(t.length,9),c=0;c<a;c++)n.words[c]=t.words[c];if(n.length=a,t.length<=9){t.words[0]=0,t.length=1;return}var p=t.words[9];for(n.words[n.length++]=p&o,c=10;c<t.length;c++){var g=t.words[c]|0;t.words[c-10]=(g&o)<<4|p>>>22,p=g}p>>>=22,t.words[c-10]=p,p===0&&t.length>10?t.length-=10:t.length-=9},E.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var n=0,o=0;o<t.length;o++){var a=t.words[o]|0;n+=a*977,t.words[o]=n&67108863,n=a*64+(n/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function C(){w.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}m(C,w);function I(){w.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}m(I,w);function vt(){w.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}m(vt,w),vt.prototype.imulK=function(t){for(var n=0,o=0;o<t.length;o++){var a=(t.words[o]|0)*19+n,c=a&67108863;a>>>=26,t.words[o]=c,n=a}return n!==0&&(t.words[t.length++]=n),t},u._prime=function(t){if(_[t])return _[t];var n;if(t==="k256")n=new E;else if(t==="p224")n=new C;else if(t==="p192")n=new I;else if(t==="p25519")n=new vt;else throw new Error("Unknown prime "+t);return _[t]=n,n};function N(d){if(typeof d=="string"){var t=u._prime(d);this.m=t.p,this.prime=t}else l(d.gtn(1),"modulus must be greater than 1"),this.m=d,this.prime=null}N.prototype._verify1=function(t){l(t.negative===0,"red works only with positives"),l(t.red,"red works only with red numbers")},N.prototype._verify2=function(t,n){l((t.negative|n.negative)===0,"red works only with positives"),l(t.red&&t.red===n.red,"red works only with red numbers")},N.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},N.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},N.prototype.add=function(t,n){this._verify2(t,n);var o=t.add(n);return o.cmp(this.m)>=0&&o.isub(this.m),o._forceRed(this)},N.prototype.iadd=function(t,n){this._verify2(t,n);var o=t.iadd(n);return o.cmp(this.m)>=0&&o.isub(this.m),o},N.prototype.sub=function(t,n){this._verify2(t,n);var o=t.sub(n);return o.cmpn(0)<0&&o.iadd(this.m),o._forceRed(this)},N.prototype.isub=function(t,n){this._verify2(t,n);var o=t.isub(n);return o.cmpn(0)<0&&o.iadd(this.m),o},N.prototype.shl=function(t,n){return this._verify1(t),this.imod(t.ushln(n))},N.prototype.imul=function(t,n){return this._verify2(t,n),this.imod(t.imul(n))},N.prototype.mul=function(t,n){return this._verify2(t,n),this.imod(t.mul(n))},N.prototype.isqr=function(t){return this.imul(t,t.clone())},N.prototype.sqr=function(t){return this.mul(t,t)},N.prototype.sqrt=function(t){if(t.isZero())return t.clone();var n=this.m.andln(3);if(l(n%2===1),n===3){var o=this.m.add(new u(1)).iushrn(2);return this.pow(t,o)}for(var a=this.m.subn(1),c=0;!a.isZero()&&a.andln(1)===0;)c++,a.iushrn(1);l(!a.isZero());var p=new u(1).toRed(this),g=p.redNeg(),h=this.m.subn(1).iushrn(1),r=this.m.bitLength();for(r=new u(2*r*r).toRed(this);this.pow(r,h).cmp(g)!==0;)r.redIAdd(g);for(var f=this.pow(r,a),M=this.pow(t,a.addn(1).iushrn(1)),b=this.pow(t,a),R=c;b.cmp(p)!==0;){for(var S=b,O=0;S.cmp(p)!==0;O++)S=S.redSqr();l(O<R);var T=this.pow(f,new u(1).iushln(R-O-1));M=M.redMul(T),f=T.redSqr(),b=b.redMul(f),R=O}return M},N.prototype.invm=function(t){var n=t._invmp(this.m);return n.negative!==0?(n.negative=0,this.imod(n).redNeg()):this.imod(n)},N.prototype.pow=function(t,n){if(n.isZero())return new u(1).toRed(this);if(n.cmpn(1)===0)return t.clone();var o=4,a=new Array(1<<o);a[0]=new u(1).toRed(this),a[1]=t;for(var c=2;c<a.length;c++)a[c]=this.mul(a[c-1],t);var p=a[0],g=0,h=0,r=n.bitLength()%26;for(r===0&&(r=26),c=n.length-1;c>=0;c--){for(var f=n.words[c],M=r-1;M>=0;M--){var b=f>>M&1;if(p!==a[0]&&(p=this.sqr(p)),b===0&&g===0){h=0;continue}g<<=1,g|=b,h++,!(h!==o&&(c!==0||M!==0))&&(p=this.mul(p,a[g]),h=0,g=0)}r=26}return p},N.prototype.convertTo=function(t){var n=t.umod(this.m);return n===t?n.clone():n},N.prototype.convertFrom=function(t){var n=t.clone();return n.red=null,n},u.mont=function(t){return new kt(t)};function kt(d){N.call(this,d),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new u(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}m(kt,N),kt.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},kt.prototype.convertFrom=function(t){var n=this.imod(t.mul(this.rinv));return n.red=null,n},kt.prototype.imul=function(t,n){if(t.isZero()||n.isZero())return t.words[0]=0,t.length=1,t;var o=t.imul(n),a=o.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),c=o.isub(a).iushrn(this.shift),p=c;return c.cmp(this.m)>=0?p=c.isub(this.m):c.cmpn(0)<0&&(p=c.iadd(this.m)),p._forceRed(this)},kt.prototype.mul=function(t,n){if(t.isZero()||n.isZero())return new u(0)._forceRed(this);var o=t.mul(n),a=o.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),c=o.isub(a).iushrn(this.shift),p=c;return c.cmp(this.m)>=0?p=c.isub(this.m):c.cmpn(0)<0&&(p=c.iadd(this.m)),p._forceRed(this)},kt.prototype.invm=function(t){var n=this.imod(t._invmp(this.m).mul(this.r2));return n._forceRed(this)}})(i,wt)})(wn);const Mn=pe;var _n=Me;Me.strict=pr;Me.loose=gr;var bn=Object.prototype.toString,Rn={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function Me(i){return pr(i)||gr(i)}function pr(i){return i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array||i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Uint16Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array}function gr(i){return Rn[bn.call(i)]}var Sn=_n.strict,En=function(e){if(Sn(e)){var s=Ht.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(s=s.slice(e.byteOffset,e.byteOffset+e.byteLength)),s}else return Ht.from(e)};const mr="hex",vr="utf8",Dt="0";function Ct(i){return new Uint8Array(i)}function yr(i,e=!1){const s=i.toString(mr);return e?Lt(s):s}function In(i){return i.toString(vr)}function Jt(i){return En(i)}function At(i,e=!1){return yr(Jt(i),e)}function xn(i){return In(Jt(i))}function kn(i){return Ht.from(Et(i),mr)}function qt(i){return Ct(kn(i))}function _e(i){return Ht.from(i,vr)}function On(i){return Ct(_e(i))}function Tn(i,e=!1){return yr(_e(i),e)}function An(i,e){return!(typeof i!="string"||!i.match(/^0x[0-9A-Fa-f]*$/)||e&&i.length!==2+2*e)}function wr(...i){let e=[];return i.forEach(s=>e=e.concat(Array.from(s))),new Uint8Array([...e])}function qn(i,e=8){const s=i%e;return s?(i-s)/e*e+e:i}function Cn(i,e=8,s=Dt){return Nn(i,qn(i.length,e),s)}function Nn(i,e,s=Dt){return Un(i,e,!0,s)}function Et(i){return i.replace(/^0x/,"")}function Lt(i){return i.startsWith("0x")?i:`0x${i}`}function Mr(i){return i=Et(i),i=Cn(i,2),i&&(i=Lt(i)),i}function Ln(i){const e=i.startsWith("0x");return i=Et(i),i=i.startsWith(Dt)?i.substring(1):i,e?Lt(i):i}function Un(i,e,s,l=Dt){const m=e-i.length;let u=i;if(m>0){const x=l.repeat(m);u=s?x+i:i+x}return u}function ge(i){return Jt(new Uint8Array(i))}function Pn(i,e){return At(new Uint8Array(i),!e)}function Bn(i){return Ct(i).buffer}function jn(i){return _e(i)}function $n(i,e){return Tn(i,!e)}function Hn(i){return qt(i).buffer}function _r(i,e){const s=Et(Mr(new Mn(i).toString(16)));return e?s:Lt(s)}function Fn(){const i=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return i+e}function $t(i){return Mr(i)}function Dn(i){return Ln(Lt(i))}const Jn=Fn;function ue(){return((e,s)=>{for(s=e="";e++<36;s+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return s})()}function Zn(i,e){let s;const l=yn[i];return l&&(s=`https://${l}.infura.io/v3/${e}`),s}function Vn(i,e){let s;const l=Zn(i,e.infuraId);return e.custom&&e.custom[i]?s=e.custom[i]:l&&(s=l),s}function Wn(i){return i===""||typeof i=="string"&&i.trim()===""}function zn(i){return!(i&&i.length)}function br(i,e){return An(i,e)}function Qn(i){return typeof i.method<"u"}function Ut(i){return typeof i.result<"u"}function Ft(i){return typeof i.error<"u"}function Xe(i){return typeof i.event<"u"}function Kn(i){return vn.includes(i)||i.startsWith("wc_")}function Gn(i){return i.method.startsWith("wc_")?!0:!we.includes(i.method)}function Xn(i){i=Et(i.toLowerCase());const e=Et(Cr.keccak_256(jn(i)));let s="";for(let l=0;l<i.length;l++)parseInt(e[l],16)>7?s+=i[l].toUpperCase():s+=i[l];return Lt(s)}const Yn=i=>i?i.toLowerCase().substring(0,2)!=="0x"?!1:/^(0x)?[0-9a-f]{40}$/i.test(i)?/^(0x)?[0-9a-f]{40}$/.test(i)||/^(0x)?[0-9A-F]{40}$/.test(i)?!0:i===Xn(i):!1:!1;function Ye(i){return!zn(i)&&!br(i[0])&&(i[0]=$n(i[0])),i}function le(i){if(typeof i.type<"u"&&i.type!=="0")return i;if(typeof i.from>"u"||!Yn(i.from))throw new Error("Transaction object must include a valid 'from' value.");function e(m){let u=m;return(typeof m=="number"||typeof m=="string"&&!Wn(m))&&(br(m)?typeof m=="string"&&(u=$t(m)):u=_r(m)),typeof u=="string"&&(u=Dn(u)),u}const s={from:$t(i.from),to:typeof i.to>"u"?void 0:$t(i.to),gasPrice:typeof i.gasPrice>"u"?"":e(i.gasPrice),gas:typeof i.gas>"u"?typeof i.gasLimit>"u"?"":e(i.gasLimit):e(i.gas),value:typeof i.value>"u"?"":e(i.value),nonce:typeof i.nonce>"u"?"":e(i.nonce),data:typeof i.data>"u"?"":$t(i.data)||"0x"},l=["gasPrice","gas","value","nonce"];return Object.keys(s).forEach(m=>{(typeof s[m]>"u"||typeof s[m]=="string"&&!s[m].trim().length)&&l.includes(m)&&delete s[m]}),s}function ti(i){const e=i.message||"Failed or Rejected Request";let s=-32e3;if(i&&!i.code)switch(e){case"Parse error":s=-32700;break;case"Invalid request":s=-32600;break;case"Method not found":s=-32601;break;case"Invalid params":s=-32602;break;case"Internal error":s=-32603;break;default:s=-32e3;break}const l={code:s,message:e};return i.data&&(l.data=i.data),l}var be={};(function(i){const e=Lr,s=Ur,l=Nr,m=v=>v==null;function u(v){switch(v.arrayFormat){case"index":return y=>(_,w)=>{const E=_.length;return w===void 0||v.skipNull&&w===null||v.skipEmptyString&&w===""?_:w===null?[..._,[k(y,v),"[",E,"]"].join("")]:[..._,[k(y,v),"[",k(E,v),"]=",k(w,v)].join("")]};case"bracket":return y=>(_,w)=>w===void 0||v.skipNull&&w===null||v.skipEmptyString&&w===""?_:w===null?[..._,[k(y,v),"[]"].join("")]:[..._,[k(y,v),"[]=",k(w,v)].join("")];case"comma":case"separator":return y=>(_,w)=>w==null||w.length===0?_:_.length===0?[[k(y,v),"=",k(w,v)].join("")]:[[_,k(w,v)].join(v.arrayFormatSeparator)];default:return y=>(_,w)=>w===void 0||v.skipNull&&w===null||v.skipEmptyString&&w===""?_:w===null?[..._,k(y,v)]:[..._,[k(y,v),"=",k(w,v)].join("")]}}function x(v){let y;switch(v.arrayFormat){case"index":return(_,w,E)=>{if(y=/\[(\d*)\]$/.exec(_),_=_.replace(/\[\d*\]$/,""),!y){E[_]=w;return}E[_]===void 0&&(E[_]={}),E[_][y[1]]=w};case"bracket":return(_,w,E)=>{if(y=/(\[\])$/.exec(_),_=_.replace(/\[\]$/,""),!y){E[_]=w;return}if(E[_]===void 0){E[_]=[w];return}E[_]=[].concat(E[_],w)};case"comma":case"separator":return(_,w,E)=>{const I=typeof w=="string"&&w.split("").indexOf(v.arrayFormatSeparator)>-1?w.split(v.arrayFormatSeparator).map(vt=>mt(vt,v)):w===null?w:mt(w,v);E[_]=I};default:return(_,w,E)=>{if(E[_]===void 0){E[_]=w;return}E[_]=[].concat(E[_],w)}}}function gt(v){if(typeof v!="string"||v.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function k(v,y){return y.encode?y.strict?e(v):encodeURIComponent(v):v}function mt(v,y){return y.decode?s(v):v}function xt(v){return Array.isArray(v)?v.sort():typeof v=="object"?xt(Object.keys(v)).sort((y,_)=>Number(y)-Number(_)).map(y=>v[y]):v}function Mt(v){const y=v.indexOf("#");return y!==-1&&(v=v.slice(0,y)),v}function _t(v){let y="";const _=v.indexOf("#");return _!==-1&&(y=v.slice(_)),y}function yt(v){v=Mt(v);const y=v.indexOf("?");return y===-1?"":v.slice(y+1)}function Tt(v,y){return y.parseNumbers&&!Number.isNaN(Number(v))&&typeof v=="string"&&v.trim()!==""?v=Number(v):y.parseBooleans&&v!==null&&(v.toLowerCase()==="true"||v.toLowerCase()==="false")&&(v=v.toLowerCase()==="true"),v}function jt(v,y){y=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},y),gt(y.arrayFormatSeparator);const _=x(y),w=Object.create(null);if(typeof v!="string"||(v=v.trim().replace(/^[?#&]/,""),!v))return w;for(const E of v.split("&")){let[C,I]=l(y.decode?E.replace(/\+/g," "):E,"=");I=I===void 0?null:["comma","separator"].includes(y.arrayFormat)?I:mt(I,y),_(mt(C,y),I,w)}for(const E of Object.keys(w)){const C=w[E];if(typeof C=="object"&&C!==null)for(const I of Object.keys(C))C[I]=Tt(C[I],y);else w[E]=Tt(C,y)}return y.sort===!1?w:(y.sort===!0?Object.keys(w).sort():Object.keys(w).sort(y.sort)).reduce((E,C)=>{const I=w[C];return Boolean(I)&&typeof I=="object"&&!Array.isArray(I)?E[C]=xt(I):E[C]=I,E},Object.create(null))}i.extract=yt,i.parse=jt,i.stringify=(v,y)=>{if(!v)return"";y=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},y),gt(y.arrayFormatSeparator);const _=I=>y.skipNull&&m(v[I])||y.skipEmptyString&&v[I]==="",w=u(y),E={};for(const I of Object.keys(v))_(I)||(E[I]=v[I]);const C=Object.keys(E);return y.sort!==!1&&C.sort(y.sort),C.map(I=>{const vt=v[I];return vt===void 0?"":vt===null?k(I,y):Array.isArray(vt)?vt.reduce(w(I),[]).join("&"):k(I,y)+"="+k(vt,y)}).filter(I=>I.length>0).join("&")},i.parseUrl=(v,y)=>{y=Object.assign({decode:!0},y);const[_,w]=l(v,"#");return Object.assign({url:_.split("?")[0]||"",query:jt(yt(v),y)},y&&y.parseFragmentIdentifier&&w?{fragmentIdentifier:mt(w,y)}:{})},i.stringifyUrl=(v,y)=>{y=Object.assign({encode:!0,strict:!0},y);const _=Mt(v.url).split("?")[0]||"",w=i.extract(v.url),E=i.parse(w,{sort:!1}),C=Object.assign(E,v.query);let I=i.stringify(C,y);I&&(I=`?${I}`);let vt=_t(v.url);return v.fragmentIdentifier&&(vt=`#${k(v.fragmentIdentifier,y)}`),`${_}${I}${vt}`}})(be);function ei(i){const e=i.indexOf("?")!==-1?i.indexOf("?"):void 0;return typeof e<"u"?i.substr(e):""}function ri(i,e){let s=Rr(i);return s=Object.assign(Object.assign({},s),e),i=ni(s),i}function Rr(i){return be.parse(i)}function ni(i){return be.stringify(i)}function ii(i){return typeof i.bridge<"u"}function si(i){const e=i.indexOf(":"),s=i.indexOf("?")!==-1?i.indexOf("?"):void 0,l=i.substring(0,e),m=i.substring(e+1,s);function u(Mt){const _t="@",yt=Mt.split(_t);return{handshakeTopic:yt[0],version:parseInt(yt[1],10)}}const x=u(m),gt=typeof s<"u"?i.substr(s):"";function k(Mt){const _t=Rr(Mt);return{key:_t.key||"",bridge:_t.bridge||""}}const mt=k(gt);return Object.assign(Object.assign({protocol:l},x),mt)}class oi{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(e,s){this._eventEmitters.push({event:e,callback:s})}trigger(e){let s=[];e&&(s=this._eventEmitters.filter(l=>l.event===e)),s.forEach(l=>{l.callback()})}}const ai=typeof Fe.WebSocket<"u"?Fe.WebSocket:require("ws");class hi{constructor(e){if(this.opts=e,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=e.protocol,this._version=e.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=e.subscriptions||[],this._netMonitor=e.netMonitor||new oi,!e.url||typeof e.url!="string")throw new Error("Missing or invalid WebSocket url");this._url=e.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(e){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(e){}get connecting(){return this.readyState===0}set connected(e){}get connected(){return this.readyState===1}set closing(e){}get closing(){return this.readyState===2}set closed(e){}get closed(){return this.readyState===3}open(){this._socketCreate()}close(){this._socketClose()}send(e,s,l){if(!s||typeof s!="string")throw new Error("Missing or invalid topic field");this._socketSend({topic:s,type:"pub",payload:e,silent:!!l})}subscribe(e){this._socketSend({topic:e,type:"sub",payload:"",silent:!0})}on(e,s){this._events.push({event:e,callback:s})}_socketCreate(){if(this._nextSocket)return;const e=fi(this._url,this._protocol,this._version);if(this._nextSocket=new ai(e),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=s=>this._socketReceive(s),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=s=>this._socketError(s),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(e){const s=JSON.stringify(e);this._socket&&this._socket.readyState===1?this._socket.send(s):(this._setToQueue(e),this._socketCreate())}async _socketReceive(e){let s;try{s=JSON.parse(e.data)}catch{return}if(this._socketSend({topic:s.topic,type:"ack",payload:"",silent:!0}),this._socket&&this._socket.readyState===1){const l=this._events.filter(m=>m.event==="message");l&&l.length&&l.forEach(m=>m.callback(s))}}_socketError(e){const s=this._events.filter(l=>l.event==="error");s&&s.length&&s.forEach(l=>l.callback(e))}_queueSubscriptions(){this._subscriptions.forEach(s=>this._queue.push({topic:s,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(e){this._queue.push(e)}_pushQueue(){this._queue.forEach(s=>this._socketSend(s)),this._queue=[]}}function fi(i,e,s){var l,m;const x=(i.startsWith("https")?i.replace("https","wss"):i.startsWith("http")?i.replace("http","ws"):i).split("?"),gt=Pr()?{protocol:e,version:s,env:"browser",host:((l=Br())===null||l===void 0?void 0:l.host)||""}:{protocol:e,version:s,env:((m=jr())===null||m===void 0?void 0:m.name)||""},k=ri(ei(x[1]||""),gt);return x[0]+"?"+k}const de="Session currently connected",Ot="Session currently disconnected",ci="Session Rejected",ui="Missing JSON RPC response",li='JSON-RPC success response must include "result" field',di='JSON-RPC error response must include "error" field',pi='JSON RPC request must have valid "method" value',gi='JSON RPC request must have valid "id" value',mi="Missing one of the required parameters: bridge / uri / session",tr="JSON RPC response format is invalid",vi="URI format is invalid",yi="QRCode Modal not provided",er="User close QRCode Modal";class wi{constructor(){this._eventEmitters=[]}subscribe(e){this._eventEmitters.push(e)}unsubscribe(e){this._eventEmitters=this._eventEmitters.filter(s=>s.event!==e)}trigger(e){let s=[],l;Qn(e)?l=e.method:Ut(e)||Ft(e)?l=`response:${e.id}`:Xe(e)?l=e.event:l="",l&&(s=this._eventEmitters.filter(m=>m.event===l)),(!s||!s.length)&&!Kn(l)&&!Xe(l)&&(s=this._eventEmitters.filter(m=>m.event==="call_request")),s.forEach(m=>{if(Ft(e)){const u=new Error(e.error.message);m.callback(u,null)}else m.callback(null,e)})}}class Mi{constructor(e="walletconnect"){this.storageId=e}getSession(){let e=null;const s=or(this.storageId);return s&&ii(s)&&(e=s),e}setSession(e){return $r(this.storageId,e),e}removeSession(){ar(this.storageId)}}const _i="walletconnect.org",bi="abcdefghijklmnopqrstuvwxyz0123456789",Sr=bi.split("").map(i=>`https://${i}.bridge.walletconnect.org`);function Ri(i){let e=i.indexOf("//")>-1?i.split("/")[2]:i.split("/")[0];return e=e.split(":")[0],e=e.split("?")[0],e}function Si(i){return Ri(i).split(".").slice(-2).join(".")}function Ei(){return Math.floor(Math.random()*Sr.length)}function Ii(){return Sr[Ei()]}function xi(i){return Si(i)===_i}function ki(i){return xi(i)?Ii():i}class Oi{constructor(e){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new wi,this._clientMeta=Je()||e.connectorOpts.clientMeta||null,this._cryptoLib=e.cryptoLib,this._sessionStorage=e.sessionStorage||new Mi(e.connectorOpts.storageId),this._qrcodeModal=e.connectorOpts.qrcodeModal,this._qrcodeModalOptions=e.connectorOpts.qrcodeModalOptions,this._signingMethods=[...we,...e.connectorOpts.signingMethods||[]],!e.connectorOpts.bridge&&!e.connectorOpts.uri&&!e.connectorOpts.session)throw new Error(mi);e.connectorOpts.bridge&&(this.bridge=ki(e.connectorOpts.bridge)),e.connectorOpts.uri&&(this.uri=e.connectorOpts.uri);const s=e.connectorOpts.session||this._getStorageSession();s&&(this.session=s),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=e.transport||new hi({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),e.connectorOpts.uri&&this._subscribeToSessionRequest(),e.pushServerOpts&&this._registerPushServer(e.pushServerOpts)}set bridge(e){e&&(this._bridge=e)}get bridge(){return this._bridge}set key(e){if(!e)return;const s=Hn(e);this._key=s}get key(){return this._key?Pn(this._key,!0):""}set clientId(e){e&&(this._clientId=e)}get clientId(){let e=this._clientId;return e||(e=this._clientId=ue()),this._clientId}set peerId(e){e&&(this._peerId=e)}get peerId(){return this._peerId}set clientMeta(e){}get clientMeta(){let e=this._clientMeta;return e||(e=this._clientMeta=Je()),e}set peerMeta(e){this._peerMeta=e}get peerMeta(){return this._peerMeta}set handshakeTopic(e){e&&(this._handshakeTopic=e)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(e){e&&(this._handshakeId=e)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(e){if(!e)return;const{handshakeTopic:s,bridge:l,key:m}=this._parseUri(e);this.handshakeTopic=s,this.bridge=l,this.key=m}set chainId(e){this._chainId=e}get chainId(){return this._chainId}set networkId(e){this._networkId=e}get networkId(){return this._networkId}set accounts(e){this._accounts=e}get accounts(){return this._accounts}set rpcUrl(e){this._rpcUrl=e}get rpcUrl(){return this._rpcUrl}set connected(e){}get connected(){return this._connected}set pending(e){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(e){e&&(this._connected=e.connected,this.accounts=e.accounts,this.chainId=e.chainId,this.bridge=e.bridge,this.key=e.key,this.clientId=e.clientId,this.clientMeta=e.clientMeta,this.peerId=e.peerId,this.peerMeta=e.peerMeta,this.handshakeId=e.handshakeId,this.handshakeTopic=e.handshakeTopic)}on(e,s){const l={event:e,callback:s};this._eventManager.subscribe(l)}off(e){this._eventManager.unsubscribe(e)}async createInstantRequest(e){this._key=await this._generateKey();const s=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(e)}]});this.handshakeId=s.id,this.handshakeTopic=ue(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error(er)});const l=()=>{this.killSession()};try{const m=await this._sendCallRequest(s);return m&&l(),m}catch(m){throw l(),m}}async connect(e){if(!this._qrcodeModal)throw new Error(yi);return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(e),new Promise(async(s,l)=>{this.on("modal_closed",()=>l(new Error(er))),this.on("connect",(m,u)=>{if(m)return l(m);s(u.params[0])})}))}async createSession(e){if(this._connected)throw new Error(de);if(this.pending)return;this._key=await this._generateKey();const s=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:e&&e.chainId?e.chainId:null}]});this.handshakeId=s.id,this.handshakeTopic=ue(),this._sendSessionRequest(s,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(e){if(this._connected)throw new Error(de);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";const s={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},l={id:this.handshakeId,jsonrpc:"2.0",result:s};this._sendResponse(l),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(e){if(this._connected)throw new Error(de);const s=e&&e.message?e.message:ci,l=this._formatResponse({id:this.handshakeId,error:{message:s}});this._sendResponse(l),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:s}]}),this._removeStorageSession()}updateSession(e){if(!this._connected)throw new Error(Ot);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";const s={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},l=this._formatRequest({method:"wc_sessionUpdate",params:[s]});this._sendSessionRequest(l,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(e){const s=e?e.message:"Session Disconnected",l={approved:!1,chainId:null,networkId:null,accounts:null},m=this._formatRequest({method:"wc_sessionUpdate",params:[l]});await this._sendRequest(m),this._handleSessionDisconnect(s)}async sendTransaction(e){if(!this._connected)throw new Error(Ot);const s=le(e),l=this._formatRequest({method:"eth_sendTransaction",params:[s]});return await this._sendCallRequest(l)}async signTransaction(e){if(!this._connected)throw new Error(Ot);const s=le(e),l=this._formatRequest({method:"eth_signTransaction",params:[s]});return await this._sendCallRequest(l)}async signMessage(e){if(!this._connected)throw new Error(Ot);const s=this._formatRequest({method:"eth_sign",params:e});return await this._sendCallRequest(s)}async signPersonalMessage(e){if(!this._connected)throw new Error(Ot);e=Ye(e);const s=this._formatRequest({method:"personal_sign",params:e});return await this._sendCallRequest(s)}async signTypedData(e){if(!this._connected)throw new Error(Ot);const s=this._formatRequest({method:"eth_signTypedData",params:e});return await this._sendCallRequest(s)}async updateChain(e){if(!this._connected)throw new Error("Session currently disconnected");const s=this._formatRequest({method:"wallet_updateChain",params:[e]});return await this._sendCallRequest(s)}unsafeSend(e,s){return this._sendRequest(e,s),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:s}]}),new Promise((l,m)=>{this._subscribeToResponse(e.id,(u,x)=>{if(u){m(u);return}if(!x)throw new Error(ui);l(x)})})}async sendCustomRequest(e,s){if(!this._connected)throw new Error(Ot);switch(e.method){case"eth_accounts":return this.accounts;case"eth_chainId":return _r(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":e.params&&(e.params[0]=le(e.params[0]));break;case"personal_sign":e.params&&(e.params=Ye(e.params));break}const l=this._formatRequest(e);return await this._sendCallRequest(l,s)}approveRequest(e){if(Ut(e)){const s=this._formatResponse(e);this._sendResponse(s)}else throw new Error(li)}rejectRequest(e){if(Ft(e)){const s=this._formatResponse(e);this._sendResponse(s)}else throw new Error(di)}transportClose(){this._transport.close()}async _sendRequest(e,s){const l=this._formatRequest(e),m=await this._encrypt(l),u=typeof(s==null?void 0:s.topic)<"u"?s.topic:this.peerId,x=JSON.stringify(m),gt=typeof(s==null?void 0:s.forcePushNotification)<"u"?!s.forcePushNotification:Gn(l);this._transport.send(x,u,gt)}async _sendResponse(e){const s=await this._encrypt(e),l=this.peerId,m=JSON.stringify(s),u=!0;this._transport.send(m,l,u)}async _sendSessionRequest(e,s,l){this._sendRequest(e,l),this._subscribeToSessionResponse(e.id,s)}_sendCallRequest(e,s){return this._sendRequest(e,s),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:s}]}),this._subscribeToCallResponse(e.id)}_formatRequest(e){if(typeof e.method>"u")throw new Error(pi);return{id:typeof e.id>"u"?Jn():e.id,jsonrpc:"2.0",method:e.method,params:typeof e.params>"u"?[]:e.params}}_formatResponse(e){if(typeof e.id>"u")throw new Error(gi);const s={id:e.id,jsonrpc:"2.0"};if(Ft(e)){const l=ti(e.error);return Object.assign(Object.assign(Object.assign({},s),e),{error:l})}else if(Ut(e))return Object.assign(Object.assign({},s),e);throw new Error(tr)}_handleSessionDisconnect(e){const s=e||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),ar(Ze)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:s}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(e,s){s?s.approved?(this._connected?(s.chainId&&(this.chainId=s.chainId),s.accounts&&(this.accounts=s.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,s.chainId&&(this.chainId=s.chainId),s.accounts&&(this.accounts=s.accounts),s.peerId&&!this.peerId&&(this.peerId=s.peerId),s.peerMeta&&!this.peerMeta&&(this.peerMeta=s.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(e):this._handleSessionDisconnect(e)}async _handleIncomingMessages(e){if(![this.clientId,this.handshakeTopic].includes(e.topic))return;let l;try{l=JSON.parse(e.payload)}catch{return}const m=await this._decrypt(l);m&&this._eventManager.trigger(m)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(e,s){this.on(`response:${e}`,s)}_subscribeToSessionResponse(e,s){this._subscribeToResponse(e,(l,m)=>{if(l){this._handleSessionResponse(l.message);return}Ut(m)?this._handleSessionResponse(s,m.result):m.error&&m.error.message?this._handleSessionResponse(m.error.message):this._handleSessionResponse(s)})}_subscribeToCallResponse(e){return new Promise((s,l)=>{this._subscribeToResponse(e,(m,u)=>{if(m){l(m);return}Ut(u)?s(u.result):u.error&&u.error.message?l(u.error):l(new Error(tr))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(e,s)=>{const{request:l}=s.params[0];if(Hr()&&this._signingMethods.includes(l.method)){const m=or(Ze);m&&(window.location.href=m.href)}}),this.on("wc_sessionRequest",(e,s)=>{e&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:e.toString()}]}),this.handshakeId=s.id,this.peerId=s.params[0].peerId,this.peerMeta=s.params[0].peerMeta;const l=Object.assign(Object.assign({},s),{method:"session_request"});this._eventManager.trigger(l)}),this.on("wc_sessionUpdate",(e,s)=>{e&&this._handleSessionResponse(e.message),this._handleSessionResponse("Session disconnected",s.params[0])})}_initTransport(){this._transport.on("message",e=>this._handleIncomingMessages(e)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){const e=this.protocol,s=this.handshakeTopic,l=this.version,m=encodeURIComponent(this.bridge),u=this.key;return`${e}:${s}@${l}?bridge=${m}&key=${u}`}_parseUri(e){const s=si(e);if(s.protocol===this.protocol){if(!s.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const l=s.handshakeTopic;if(!s.bridge)throw Error("Invalid or missing bridge url parameter value");const m=decodeURIComponent(s.bridge);if(!s.key)throw Error("Invalid or missing key parameter value");const u=s.key;return{handshakeTopic:l,bridge:m,key:u}}else throw new Error(vi)}async _generateKey(){return this._cryptoLib?await this._cryptoLib.generateKey():null}async _encrypt(e){const s=this._key;return this._cryptoLib&&s?await this._cryptoLib.encrypt(e,s):null}async _decrypt(e){const s=this._key;return this._cryptoLib&&s?await this._cryptoLib.decrypt(e,s):null}_getStorageSession(){let e=null;return this._sessionStorage&&(e=this._sessionStorage.getSession()),e}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(e){if(!e.url||typeof e.url!="string")throw Error("Invalid or missing pushServerOpts.url parameter value");if(!e.type||typeof e.type!="string")throw Error("Invalid or missing pushServerOpts.type parameter value");if(!e.token||typeof e.token!="string")throw Error("Invalid or missing pushServerOpts.token parameter value");const s={bridge:this.bridge,topic:this.clientId,type:e.type,token:e.token,peerName:"",language:e.language||""};this.on("connect",async(l,m)=>{if(l)throw l;if(e.peerMeta){const u=m.params[0].peerMeta.name;s.peerName=u}try{if(!(await(await fetch(`${e.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}})}}function Ti(i){return Nt.getBrowerCrypto().getRandomValues(new Uint8Array(i))}const Er=256,Ir=Er,Ai=Er,It="AES-CBC",qi=`SHA-${Ir}`,me="HMAC",Ci="encrypt",Ni="decrypt",Li="sign",Ui="verify";function Pi(i){return i===It?{length:Ir,name:It}:{hash:{name:qi},name:me}}function Bi(i){return i===It?[Ci,Ni]:[Li,Ui]}async function Re(i,e=It){return Nt.getSubtleCrypto().importKey("raw",i,Pi(e),!0,Bi(e))}async function ji(i,e,s){const l=Nt.getSubtleCrypto(),m=await Re(e,It),u=await l.encrypt({iv:i,name:It},m,s);return new Uint8Array(u)}async function $i(i,e,s){const l=Nt.getSubtleCrypto(),m=await Re(e,It),u=await l.decrypt({iv:i,name:It},m,s);return new Uint8Array(u)}async function Hi(i,e){const s=Nt.getSubtleCrypto(),l=await Re(i,me),m=await s.sign({length:Ai,name:me},l,e);return new Uint8Array(m)}function Fi(i,e,s){return ji(i,e,s)}function Di(i,e,s){return $i(i,e,s)}async function xr(i,e){return await Hi(i,e)}async function kr(i){const e=(i||256)/8,s=Ti(e);return Bn(Jt(s))}async function Or(i,e){const s=qt(i.data),l=qt(i.iv),m=qt(i.hmac),u=At(m,!1),x=wr(s,l),gt=await xr(e,x),k=At(gt,!1);return Et(u)===Et(k)}async function Ji(i,e,s){const l=Ct(ge(e)),m=s||await kr(128),u=Ct(ge(m)),x=At(u,!1),gt=JSON.stringify(i),k=On(gt),mt=await Fi(u,l,k),xt=At(mt,!1),Mt=wr(mt,u),_t=await xr(l,Mt),yt=At(_t,!1);return{data:xt,hmac:yt,iv:x}}async function Zi(i,e){const s=Ct(ge(e));if(!s)throw new Error("Missing key: required for decryption");if(!await Or(i,s))return null;const m=qt(i.data),u=qt(i.iv),x=await Di(u,s,m),gt=xn(x);let k;try{k=JSON.parse(gt)}catch{return null}return k}const Vi=Object.freeze(Object.defineProperty({__proto__:null,decrypt:Zi,encrypt:Ji,generateKey:kr,verifyHmac:Or},Symbol.toStringTag,{value:"Module"}));class Wi extends Oi{constructor(e,s){super({cryptoLib:Vi,connectorOpts:e,pushServerOpts:s})}}class zi{}class Qi extends zi{constructor(e){super()}}const Ki="PARSE_ERROR",Gi="INVALID_REQUEST",Xi="METHOD_NOT_FOUND",Yi="INVALID_PARAMS",Tr="INTERNAL_ERROR",Se="SERVER_ERROR",ts=[-32700,-32600,-32601,-32602,-32603],Bt={[Ki]:{code:-32700,message:"Parse error"},[Gi]:{code:-32600,message:"Invalid Request"},[Xi]:{code:-32601,message:"Method not found"},[Yi]:{code:-32602,message:"Invalid params"},[Tr]:{code:-32603,message:"Internal error"},[Se]:{code:-32e3,message:"Server error"}},Ar=Se;function es(i){return ts.includes(i)}function rr(i){return Object.keys(Bt).includes(i)?Bt[i]:Bt[Ar]}function rs(i){const e=Object.values(Bt).find(s=>s.code===i);return e||Bt[Ar]}function nr(i,e,s){return{id:i,jsonrpc:"2.0",error:ns(e,s)}}function ns(i,e){return typeof i>"u"?rr(Tr):(typeof i=="string"&&(i=Object.assign(Object.assign({},rr(Se)),{message:i})),typeof e<"u"&&(i.data=e),es(i.code)&&(i=rs(i.code)),i)}class is extends Qi{constructor(e){super(),this.events=new sr,this.accounts=[],this.chainId=1,this.pending=!1,this.bridge="https://bridge.walletconnect.org",this.qrcode=!0,this.qrcodeModalOptions=void 0,this.opts=e,this.chainId=(e==null?void 0:e.chainId)||this.chainId,this.wc=this.register(e)}get connected(){return typeof this.wc<"u"&&this.wc.connected}get connecting(){return this.pending}get connector(){return this.wc=this.register(this.opts),this.wc}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async open(e){if(this.connected){this.onOpen();return}return new Promise((s,l)=>{this.on("error",m=>{l(m)}),this.on("open",()=>{s()}),this.create(e)})}async close(){typeof this.wc>"u"||(this.wc.connected&&this.wc.killSession(),this.onClose())}async send(e){this.wc=this.register(this.opts),this.connected||await this.open(),this.sendPayload(e).then(s=>this.events.emit("payload",s)).catch(s=>this.events.emit("payload",nr(e.id,s.message)))}register(e){if(this.wc)return this.wc;this.opts=e||this.opts,this.bridge=e!=null&&e.connector?e.connector.bridge:(e==null?void 0:e.bridge)||"https://bridge.walletconnect.org",this.qrcode=typeof(e==null?void 0:e.qrcode)>"u"||e.qrcode!==!1,this.chainId=typeof(e==null?void 0:e.chainId)<"u"?e.chainId:this.chainId,this.qrcodeModalOptions=e==null?void 0:e.qrcodeModalOptions;const s={bridge:this.bridge,qrcodeModal:this.qrcode?Fr:void 0,qrcodeModalOptions:this.qrcodeModalOptions,storageId:e==null?void 0:e.storageId,signingMethods:e==null?void 0:e.signingMethods,clientMeta:e==null?void 0:e.clientMeta};if(this.wc=typeof(e==null?void 0:e.connector)<"u"?e.connector:new Wi(s),typeof this.wc>"u")throw new Error("Failed to register WalletConnect connector");return this.wc.accounts.length&&(this.accounts=this.wc.accounts),this.wc.chainId&&(this.chainId=this.wc.chainId),this.registerConnectorEvents(),this.wc}onOpen(e){this.pending=!1,e&&(this.wc=e),this.events.emit("open")}onClose(){this.pending=!1,this.wc&&(this.wc=void 0),this.events.emit("close")}onError(e,s="Failed or Rejected Request",l=-32e3,m){const u={id:e.id,jsonrpc:e.jsonrpc,error:{code:l,message:s}};return typeof m<"u"&&(u.error.data=m),this.events.emit("payload",u),u}create(e){this.wc=this.register(this.opts),this.chainId=e||this.chainId,!(this.connected||this.pending)&&(this.pending=!0,this.registerConnectorEvents(),this.wc.createSession({chainId:this.chainId}).then(()=>this.events.emit("created")).catch(s=>this.events.emit("error",s)))}registerConnectorEvents(){this.wc=this.register(this.opts),this.wc.on("connect",e=>{var s,l;if(e){this.events.emit("error",e);return}this.accounts=((s=this.wc)===null||s===void 0?void 0:s.accounts)||[],this.chainId=((l=this.wc)===null||l===void 0?void 0:l.chainId)||this.chainId,this.onOpen()}),this.wc.on("disconnect",e=>{if(e){this.events.emit("error",e);return}this.onClose()}),this.wc.on("modal_closed",()=>{this.events.emit("error",new Error("User closed modal"))}),this.wc.on("session_update",(e,s)=>{const{accounts:l,chainId:m}=s.params[0];(!this.accounts||l&&this.accounts!==l)&&(this.accounts=l,this.events.emit("accountsChanged",l)),(!this.chainId||m&&this.chainId!==m)&&(this.chainId=m,this.events.emit("chainChanged",m))})}async sendPayload(e){this.wc=this.register(this.opts);try{const s=await this.wc.unsafeSend(e);return this.sanitizeResponse(s)}catch(s){return this.onError(e,s.message)}}sanitizeResponse(e){return typeof e.error<"u"&&typeof e.error.code>"u"?nr(e.id,e.error.message,e.error.data):e}}class fs{constructor(e){this.events=new sr,this.rpc={infuraId:e==null?void 0:e.infuraId,custom:e==null?void 0:e.rpc},this.signer=new Ve(new is(e));const s=this.signer.connection.chainId||(e==null?void 0:e.chainId)||1;this.http=this.setHttpProvider(s),this.registerEventListeners()}get connected(){return this.signer.connection.connected}get connector(){return this.signer.connection.connector}get accounts(){return this.signer.connection.accounts}get chainId(){return this.signer.connection.chainId}get rpcUrl(){var e;return((e=this.http)===null||e===void 0?void 0:e.connection).url||""}async request(e){switch(e.method){case"eth_requestAccounts":return await this.connect(),this.signer.connection.accounts;case"eth_accounts":return this.signer.connection.accounts;case"eth_chainId":return this.signer.connection.chainId}if(we.includes(e.method))return this.signer.request(e);if(typeof this.http>"u")throw new Error(`Cannot request JSON-RPC method (${e.method}) without provided rpc url`);return this.http.request(e)}sendAsync(e,s){this.request(e).then(l=>s(null,l)).catch(l=>s(l,void 0))}async enable(){return await this.request({method:"eth_requestAccounts"})}async connect(){this.signer.connection.connected||await this.signer.connect()}async disconnect(){this.signer.connection.connected&&await this.signer.disconnect()}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}removeListener(e,s){this.events.removeListener(e,s)}off(e,s){this.events.off(e,s)}get isWalletConnect(){return!0}registerEventListeners(){this.signer.connection.on("accountsChanged",e=>{this.events.emit("accountsChanged",e)}),this.signer.connection.on("chainChanged",e=>{this.http=this.setHttpProvider(e),this.events.emit("chainChanged",e)}),this.signer.on("disconnect",()=>{this.events.emit("disconnect")})}setHttpProvider(e){const s=Vn(e,this.rpc);return typeof s>"u"?void 0:new Ve(new mn(s))}}export{fs as default};
//# sourceMappingURL=index-a423d2ec.js.map
